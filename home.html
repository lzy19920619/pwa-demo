<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0a7cff" />
  <title>é¦–é¡µ - ç§»åŠ¨è´§å“ç®¡ç†ç³»ç»Ÿ</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    :root {
      --bg: #f7f9fc;
      --card: #fff;
      --txt: #111;
      --muted: #666;
      --brand: #0a7cff;
      --danger: #c00;
      --ok: #0a7c2f;
      --border: #e0e0e0;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      height: 100%;
    }
    
    /* é¡¶éƒ¨å¯¼èˆªæ  */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: #fff;
      border-bottom: 1px solid #eaeaea;
      position: sticky;
      top: 0;
      z-index: 10;
      height: 60px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
    }
    
    .back-btn {
      background: none;
      border: none;
      font-size: 20px;
      margin-right: 15px;
      cursor: pointer;
      color: var(--brand);
    }
    
    .header-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    /* ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ */
    .user-info {
      background: var(--card);
      margin: 16px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .info-row {
      display: flex;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .info-label {
      width: 100px;
      color: var(--muted);
    }
    
    .info-value {
      flex: 1;
      font-weight: 500;
    }
    
    /* ä¹å®«æ ¼æŒ‰é’®åŒºåŸŸ */
    .grid-container {
      margin: 16px;
    }
    
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 12px 0;
    }
    
    .grid-item {
      padding: 25px 10px;
      font-size: 16px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid #e8edf5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 100px;
    }
    
    .grid-item:hover {
      background: #f5f9ff;
      border-color: var(--brand);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .grid-item:active {
      transform: translateY(0);
    }
    
    .grid-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .grid-text {
      text-align: center;
      font-weight: 500;
    }
    
    .empty-item {
      background: #f9f9f9;
      border: 1px dashed #ddd;
      color: #aaa;
      cursor: default;
    }
    
    .empty-item:hover {
      background: #f9f9f9;
      border: 1px dashed #ddd;
      transform: none;
      box-shadow: none;
    }
    
    /* ä½œä¸šåˆ†é…å¼¹çª—æ ·å¼ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .task-modal {
      background: white;
      width: 85%;
      max-width: 400px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    
    .modal-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #eee;
      font-size: 18px;
      font-weight: 600;
    }
    
    .modal-options {
      display: flex;
      flex-direction: column;
    }
    
    .modal-option {
      padding: 18px 20px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
    }
    
    .modal-option:last-child {
      border-bottom: none;
    }
    
    .modal-option:hover {
      background: #f5f9ff;
    }
    
    .option-icon {
      margin-right: 12px;
      font-size: 20px;
    }
    
    .option-text {
      font-size: 16px;
    }
    
    .modal-footer {
      padding: 15px;
      text-align: center;
      border-top: 1px solid #eee;
    }
    
    .cancel-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 16px;
      cursor: pointer;
      padding: 8px 16px;
    }
    
    .cancel-btn:hover {
      color: var(--txt);
    }
    
    /* å…¶ä»–é¡µé¢å…±ç”¨æ ·å¼ - ä»åŸCSSä¿ç•™ */
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: var(--brand);
    }
    
    .logo {
      width: 28px;
      height: 28px;
      border-radius: 6px;
    }
    
    nav button {
      margin-left: 8px;
    }
    
    .hidden {
      display: none !important;
    }
    
    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }
    
    h1 {
      margin: 8px 0 12px;
    }
    
    h2 {
      margin: 12px 0 8px;
    }
    
    .card {
      background: var(--card);
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .tile {
      padding: 18px;
      font-size: 18px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid #e8edf5;
    }
    
    input, button {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #d5dbe6;
      font-size: 14px;
    }
    
    button {
      cursor: pointer;
      background: #fff;
    }
    
    button.primary {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }
    
    button.danger {
      background: var(--danger);
      color: #fff;
      border-color: var(--danger);
    }
    
    .list {
      list-style: none;
      padding: 0;
      margin: 12px 0;
    }
    
    .list li {
      background: #fff;
      border: 1px solid #eef1f6;
      padding: 10px 12px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .badge {
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 12px;
      background: #eef5ff;
      color: #1a6cff;
    }
    
    .meta {
      color: var(--muted);
      font-size: 12px;
    }
    
    .status {
      margin-top: 10px;
    }
    
    .status-online {
      color: var(--ok);
    }
    
    .status-offline {
      color: var(--danger);
    }
    
    footer {
      text-align: center;
      color: var(--muted);
      padding: 24px 12px;
    }
    
    @media (max-width:720px) {
      .grid-3 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="app-header">
    <div class="header-left">
      <button id="back-btn" class="back-btn">â†</button>
      <div class="header-title">åŠŸèƒ½èœå•</div>
    </div>
  </header>

  <main>
    <section id="view-home">
      <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
      <div class="user-info">
        <div class="info-row">
          <div class="info-label">ç”¨æˆ·ï¼š</div>
          <div class="info-value" id="user-name">XXX</div>
        </div>
        <div class="info-row">
          <div class="info-label">åŒºéƒ¨ï¼š</div>
          <div class="info-value" id="user-department">åŒ—äº¬åŒºéƒ¨</div>
        </div>
        <div class="info-row">
          <div class="info-label">éƒ¨é—¨ï¼š</div>
          <div class="info-value" id="user-division">é›¶å”®éƒ¨</div>
        </div>
        <div class="info-row">
          <div class="info-label">å½“å‰ä»“åº“ï¼š</div>
          <div class="info-value" id="current-warehouse">SP003810 äº¬ä¸°å°ä¸‡è¾¾AD MEGA</div>
        </div>
      </div>
      
      <!-- ä¹å®«æ ¼æŒ‰é’®åŒºåŸŸ -->
      <div class="grid-container">
        <div class="grid-3">
          <button id="go-assign" class="grid-item">
            <div class="grid-icon">ğŸ“‹</div>
            <div class="grid-text">ä½œä¸šåˆ†é…</div>
          </button>
          <button id="go-in" class="grid-item">
            <div class="grid-icon">ğŸ“¥</div>
            <div class="grid-text">å…¥åº“æ‰«æ</div>
          </button>
          <button id="go-out" class="grid-item">
            <div class="grid-icon">ğŸ“¤</div>
            <div class="grid-text">å‡ºåº“æ‰«æ</div>
          </button>
          <button id="go-sync" class="grid-item">
            <div class="grid-icon">ğŸ”„</div>
            <div class="grid-text">æ•°æ®åŒæ­¥</div>
          </button>
          <button id="go-settings" class="grid-item">
            <div class="grid-icon">âš™ï¸</div>
            <div class="grid-text">ç³»ç»Ÿè®¾ç½®</div>
          </button>
          <div class="grid-item empty-item">
            <div class="grid-text">é¢„ç•™</div>
          </div>
          <div class="grid-item empty-item">
            <div class="grid-text">é¢„ç•™</div>
          </div>
          <div class="grid-item empty-item">
            <div class="grid-text">é¢„ç•™</div>
          </div>
          <div class="grid-item empty-item">
            <div class="grid-text">é¢„ç•™</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ä½œä¸šåˆ†é…å¼¹çª— -->
  <div id="task-modal" class="modal-overlay">
    <div class="task-modal">
      <div class="modal-header">ä½œä¸šåˆ†é…</div>
      <div class="modal-options">
        <div class="modal-option" data-target="task-assign.html">
          <div class="option-icon">ğŸ“</div>
          <div class="option-text">ä»»åŠ¡åˆ†é…</div>
        </div>
        <div class="modal-option" data-target="merge-order.html">
          <div class="option-icon">ğŸ“„</div>
          <div class="option-text">åˆå¹¶å•æ®</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <script>
    // é¡µé¢è·³è½¬å‡½æ•°
    function go(page) {
      window.location.href = page;
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // æ ¡éªŒç™»å½•çŠ¶æ€
      if (!localStorage.getItem('authed')) {
        window.location.href = '/login.html';
        return;
      }

      // è·å–ç”¨æˆ·ä¿¡æ¯
      const username = localStorage.getItem('username') || 'XXX';
      const userDepartment = localStorage.getItem('userDepartment') || 'åŒ—äº¬åŒºéƒ¨';
      const userDivision = localStorage.getItem('userDivision') || 'é›¶å”®éƒ¨';
      
      // è·å–ä»“åº“ä¿¡æ¯
      let warehouseInfo = 'SP003810 äº¬ä¸°å°ä¸‡è¾¾AD MEGA';
      try {
        const selectedWarehouse = JSON.parse(localStorage.getItem('selectedWarehouse'));
        if (selectedWarehouse && selectedWarehouse.code && selectedWarehouse.name) {
          warehouseInfo = `${selectedWarehouse.code} ${selectedWarehouse.name}`;
        }
      } catch (e) {
        console.warn('æ— æ³•è§£æä»“åº“ä¿¡æ¯:', e);
      }
      
      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
      document.getElementById('user-name').textContent = username;
      document.getElementById('user-department').textContent = userDepartment;
      document.getElementById('user-division').textContent = userDivision;
      document.getElementById('current-warehouse').textContent = warehouseInfo;

      // è¿”å›æŒ‰é’®äº‹ä»¶
      document.getElementById('back-btn').addEventListener('click', function() {
        // æ¸…é™¤ç™»å½•çŠ¶æ€
        localStorage.removeItem('authed');
        localStorage.removeItem('username');
        localStorage.removeItem('selectedWarehouse');
        
        // è·³è½¬åˆ°ç™»å½•é¡µé¢
        window.location.href = '/login.html';
      });

      // ä½œä¸šåˆ†é…æŒ‰é’®äº‹ä»¶ - æ˜¾ç¤ºå¼¹çª—
      document.getElementById('go-assign').addEventListener('click', function() {
        document.getElementById('task-modal').style.display = 'flex';
      });

      // å¼¹çª—é€‰é¡¹ç‚¹å‡»äº‹ä»¶
      const modalOptions = document.querySelectorAll('.modal-option');
      modalOptions.forEach(option => {
        option.addEventListener('click', function() {
          const targetPage = this.getAttribute('data-target');
          go(targetPage);
        });
      });

      // å¼¹çª—å–æ¶ˆæŒ‰é’®äº‹ä»¶
      document.querySelector('.cancel-btn').addEventListener('click', function() {
        document.getElementById('task-modal').style.display = 'none';
      });

      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
      document.getElementById('task-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      });

      // å…¶ä»–æŒ‰é’®äº‹ä»¶
      document.getElementById('go-in').addEventListener('click', () => go('/in.html'));
      document.getElementById('go-out').addEventListener('click', () => go('/out.html'));
      document.getElementById('go-sync').addEventListener('click', () => go('/sync.html'));
      document.getElementById('go-settings').addEventListener('click', () => go('/settings.html'));
    });
  </script>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(() => console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ'))
          .catch(err => console.warn('âŒ Service Worker æ³¨å†Œå¤±è´¥:', err));
      });
    }
  </script>
</body>
</html>